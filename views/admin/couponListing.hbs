<div class="container-fluid d-flex" style="background-color: #D9D9D9;">
    <div class="sideMenu">
        <a href="/admin"><button type="button" class="btn btn-light sideMenuButton" ><i class="bi bi-view-list"></i> <span class="menuLabel"> Dashboard</span></button></a>
        <a href="/admin/customers"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-people-fill"></i><span class="menuLabel"> Customers</span></button></a>
        <a href="/admin/products"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-seam-fill"></i><span class="menuLabel"> Products</span></button></a>
        <a href="/admin/orders"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-receipt"></i><span class="menuLabel"> Orders</span></button></a>
        <a href="/admin/coupons"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-ticket-perforated-fill"></i><span class="menuLabel"> Coupen Management</span></button></a>
        <a href="/admin/salesReport"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-journal-bookmark"></i><span class="menuLabel"> Sales Report</span></button></a>
        <a href="/admin/category"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-collection-fill"></i><span class="menuLabel"> Catagory</span></button></a>
        <a href="/admin/offers"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-graph-down-arrow"></i><span class="menuLabel"> Offers</span></button></a>
        <dir class="separator mt-3 pt-5"></dir>
        
        <a href="/admin/logout"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-arrow-right"></i><span class="menuLabel"> Logout</span></button></a>
    </div>
    <div class="customerDetails ">
        <a href="/admin/addCoupon" class="btn btn-primary ms-auto mb-5" style="width: auto;">Add New Coupon</a>
        <table class="table" id="myTable" style="width: 100%;">
            <h3>Your Coupons</h3>
            <thead>
                <tr>
                <th scope="col">Coupon Code</th>
                <th scope="col">Discount(%)</th>
                <th scope="col">Minimum Spend(Rs.)</th>
                <th scope="col">Expiry Date</th>
                <th scope="col">Status</th>
                <th scope="col">Update</th>
                </tr>
            </thead>
            <tbody>
                {{#each dateModifiedCoupons}}
                <tr>
                    <td id="productName">{{this.couponCode}}</td>
                    <td id="category">{{this.discount}}</td>
                    <td id="brandName">{{this.minimumSpend}}</td>
                    <td id="offerPrice">{{this.expiryAt}}</td>
                    {{#if this.isActive}}
                        <td><span id="couponStatus_{{this._id}}" class="badge rounded-pill text-bg-success">Active</span></td>
                    {{else}}
                        <td><span id="couponStatus_{{this._id}}" class="badge rounded-pill text-bg-danger">Inactive</span></td>
                    {{/if}}
                    {{#if this.isActive}}
                        <td>
                        <a id="blockButton_{{this._id}}" class="btn btn-success mb-2" onclick="if (confirm(`Are you sure you want to update coupon status`)) { statusUpdate('{{this._id}}'); }"><i class="bi bi-ban"></i></a>
                        <a href="/admin/editCoupon/{{this._id}}" class="btn btn-warning mb-2"><i class="bi bi-pencil-square"></i></a>
                        <a href="/admin/deleteCoupon/{{this._id}}" class="btn btn-danger mb-2" onclick="return confirm(`Are you sure want to delete this coupon?`)"><i class="bi bi-trash-fill"></i></a>
                        </td>
                    {{else}}
                        <td>
                        <a id="blockButton_{{this._id}}" class="btn btn-danger" onclick="if (confirm(`Are you sure you want to update coupon status`)) { statusUpdate('{{this._id}}'); }"><i class="bi bi-ban"></i></a>
                        <a href="/admin/editCoupon/{{this._id}}" class="btn btn-warning"><i class="bi bi-pencil-square"></i></a>
                        <a href="/admin/deleteCoupon/{{this._id}}" class="btn btn-danger" onclick="return confirm(`Are you sure want to delete this coupon?`)"><i class="bi bi-trash-fill"></i></a>
                        </td>
                    {{/if}}
                </tr>
                {{/each}}
            </tbody>
        </table>
        <nav aria-label="Page navigation example">
            <ul class="pagination d-flex justify-content-center mt-5">
                {{#if previousPage}}
                <li class="page-item" id="previousPage" value="{{previousPage}}"><a class="page-link" href="/admin/coupons?page={{previousPage}}">Previous</a></li>
                {{/if}}
                <li class="page-item" id="currentPageValue" value="{{currentPage}}"><a class="page-link" id="currentPage" href="/admin/coupons?page={{currentPage}}">{{currentPage}}</a></li>
                {{#if nextPage}}
                <li class="page-item" id="nextPage" value="{{nextPage}}"><a class="page-link" href="/admin/coupons?page={{nextPage}}">Next</a></li> 
                {{/if}}
            </ul>
        </nav>
    </div>
</div>

<script>
    function statusUpdate(id){
        data = {couponId:id}
        fetch('/admin/updateCouponStatus',{
            method: 'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(data)
        })
        .then(response => {
            return response.json();
        })
        .then(data =>{
            const coupondStatus = document.getElementById(`couponStatus_${id}`);
            const blockButton = document.getElementById(`blockButton_${id}`);
            if(data.isActive){
                coupondStatus.innerText = "Active";
                coupondStatus.classList.remove("text-bg-danger");
                coupondStatus.classList.add("text-bg-success");
                blockButton.classList.remove("btn-danger");
                blockButton.classList.add("btn-success");
            }else{
                coupondStatus.innerText = "Inactive";
                coupondStatus.classList.remove("text-bg-success");
                coupondStatus.classList.add("text-bg-danger");
                blockButton.classList.remove("btn-success");
                blockButton.classList.add("btn-danger");
            }
        })
    }
</script>