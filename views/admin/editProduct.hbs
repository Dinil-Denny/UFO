<div class="container-fluid d-flex" style="background-color: #D9D9D9;">
    <div class="sideMenu">
        <a href="/admin"><button type="button" class="btn btn-light sideMenuButton" ><i class="bi bi-view-list"></i> <span class="menuLabel"> Dashboard</span></button></a>
        <a href="/admin/customers"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-people-fill"></i><span class="menuLabel"> Customers</span></button></a>
        <a href="/admin/products"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-seam-fill"></i><span class="menuLabel"> Products</span></button></a>
        <a href="/admin/orders"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-receipt"></i><span class="menuLabel"> Orders</span></button></a>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-card-image"></i><span class="menuLabel"> Banner Management</span></button></a>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-ticket-perforated-fill"></i><span class="menuLabel"> Coupen Management</span></button></a>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-journal-bookmark"></i><span class="menuLabel"> Sales Report</span></button></a>
        <a href="/admin/category"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-collection-fill"></i><span class="menuLabel"> Catagory</span></button></a>
        <dir class="separator mt-5 pt-5"></dir>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-gear"></i><span class="menuLabel"> Settings</span></button></a>
        <a href="/admin/logout"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-arrow-right"></i><span class="menuLabel"> Logout</span></button></a>
    </div>
    <div class="product ms-5 my-5" style="width: 50vw;">
        <div class="productsForm">
            <h3>Edit Product Details</h3>
            <form class="row mt-3" action="/admin/editProduct/{{product._id}}" method="post" enctype="multipart/form-data">
                <div class="col-md-6 mb-3">
                    <label for="productName" class="form-label">Product Name</label>
                    <input type="text" name="productName" class="form-control" id="productName" value="{{product.productName}}" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="brandName" class="form-label">Brand Name</label>
                    <input type="text" name="brandName" class="form-control" id="brandName" value="{{product.brandName}}" required>
                </div>
                <div class="col-12 mb-3">
                    <label for="productDescription" class="form-label">Product Description</label>
                    <textarea class="form-control" name="description" id="productDescription" rows="3" required>{{product.description}}</textarea>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="gender" class="form-label">Gender</label>
                    <select name="gender" id="gender" class="form-select" required>
                        <option selected value="{{product.gender}}">{{product.gender}} (current value)</option>
                        <option value="male">male</option>
                        <option value="female">female</option>
                        <option value="unisex">unisex</option>
                        <option value="other">other</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="price" class="form-label">Price</label>
                    <input type="text" name="price" class="form-control" id="price" value="{{product.price}}" onchange="preventNegative(this)" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="offerPrice" class="form-label">Offer Price</label>
                    <input type="text" name="offerPrice" class="form-control" id="offerPrice" value="{{product.offerPrice}}" onchange=" priceCheck(this)" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="size" class="form-label">Size</label>
                    <select id="size" name="size" class="form-select" required>
                        <option selected value="{{product.size}}">{{product.size}} (current value)</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                    </select>
                    {{!-- <input type="text" name="size" class="form-control" id="size"> --}}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="color" class="form-label">Color</label>
                    <input type="text" name="color" class="form-control" id="color" value="{{product.color}}" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="stock" class="form-label">Total number of stock</label>
                    <input type="text" name="stock" class="form-control" id="stock" value="{{product.stock}}" onchange="preventNegative(this)" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="category" class="form-label">Category</label>
                    <select id="category" name="category" class="form-select" required>
                    <option selected value="{{product.category}}">{{category.catagoryName}} (current value)</option>
                    {{#each categories}}
                        <option value="{{_id}}">{{catagoryName}}</option>
                    {{/each}}
                    </select>
                </div>
                
                <div class="separator"></div>

                {{!-- displaying the uploaded images --}}
                <h6 class="mt-4">uploaded images</h6>
                {{#each product.images}}
                    <div class="col-md-3 mb-3">
                    <img src="{{this}}" alt="Product Image" class="img-thumbnail">
                    <label for="{{this}}">
                    <input id="{{this}}" type="checkbox" name="removeImages[]" value="{{this}}"> Remove Image
                    </label>
                    </div>
                {{/each}}
                <div class="separator"></div>
                {{!-- uploading new images --}}
                <div class="mb-3 col-md-8 mt-5">
                    <label for="images" class="form-label">Upload New Images (optional)</label>
                    <input class="form-control" accept="image/*" name="images" type="file" id="images" onchange="countImage(event);previewImage(event);" multiple>
                </div>
                
                <div class="col-12 d-flex justify-content-center">
                    <button type="submit" class="btn btn-primary mt-5" style="width: 50%;">Save changes</button>
                </div>
            </form>
            <div class="notification text-center text-danger">
                {{#if message}}
                    <p>{{message}}</p>
                {{/if}}
            </div>
        </div>
    </div>
</div> 

<script>
    //preventing entering negative values 
    function preventNegative(input){
        if(parseFloat(input.value)<0){
            input.setCustomValidity('Value cannot be negative');
        }else{
            input.setCustomValidity('');
        }
    }

    //checking offer-price is greater than original price
    function priceCheck(input){
        const originalPrice = document.getElementById('price');
        if(parseFloat(input.value)>parseFloat(originalPrice.value)){
            input.setCustomValidity('Offer price should be less than normal price');
        }else if(parseFloat(input.value)<0){
            input.setCustomValidity('Price value should be positive');
        }else{
            input.setCustomValidity('');
        }
    }

    //counting image
    function countImage(event){
        const maxImage = 5;
        const input = event.target;
        if(input.files.length>maxImage){
            alert("You can upload maximun of 5 images only!!!");
            input.value = '';
        }
    }

     //for showing selected images
    function previewImage(event){
        fileInput = event.target;
        console.log(fileInput);
        const files = event.target.files;
        console.log("files: ",files);
        for(const file of files){
            const fileType = file.type;
            console.log("fileType: ",fileType)
            if(fileType!=='image/jpeg' && fileType!=='image/png' && fileType!=='image/jpg'){
                alert("Only image files are allowed...!");
                fileInput.value = '';
                break;
            }
        }
    }
</script>