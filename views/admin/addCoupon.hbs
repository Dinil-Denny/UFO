<div class="container-fluid d-flex" style="background-color: #D9D9D9;">
    <div class="sideMenu">
        <a href="/admin"><button type="button" class="btn btn-light sideMenuButton" ><i class="bi bi-view-list"></i> <span class="menuLabel"> Dashboard</span></button></a>
        <a href="/admin/customers"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-people-fill"></i><span class="menuLabel"> Customers</span></button></a>
        <a href="/admin/products"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-seam-fill"></i><span class="menuLabel"> Products</span></button></a>
        <a href="/admin/orders"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-receipt"></i><span class="menuLabel"> Orders</span></button></a>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-card-image"></i><span class="menuLabel"> Banner Management</span></button></a>
        <a href="/admin/coupons"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-ticket-perforated-fill"></i><span class="menuLabel"> Coupen Management</span></button></a>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-journal-bookmark"></i><span class="menuLabel"> Sales Report</span></button></a>
        <a href="/admin/category"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-collection-fill"></i><span class="menuLabel"> Catagory</span></button></a>
        <dir class="separator mt-4 pt-5"></dir>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-gear"></i><span class="menuLabel"> Settings</span></button></a>
        <a href="/admin/logout"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-arrow-right"></i><span class="menuLabel"> Logout</span></button></a>
    </div>
    <div class="product ms-5 my-5" style="width: 60vw;">
        <div class="productsForm">
            <h3>Add Coupon</h3>
            <form class="row mt-5" id="couponCodeForm" action="/admin/addCoupon" method="post">
                <div class="col-md-6 my-3">
                    <label for="couponCode" class="form-label">Cupon code(A-Z and 1-9)</label>
                    <input type="text" name="couponCode" class="form-control" id="couponCode" placeholder="eg: OFF50 (min length 4 & max length 8)" onkeyup="validateCouponCode()" required>
                    <div class="text-danger" id="couponCodeError" style="font-size: small;">
                        {{#if message}}
                        <p>{{message}}</p>
                        {{/if}}
                    </div>
                </div>
                <div class="col-md-6 my-3">
                    <label for="discount" class="form-label">Discount in percentage(Max 90, Min 5)</label>
                    <input type="text" name="discount" class="form-control" id="discount" placeholder="eg: 50" onkeyup="validateDiscount()" required>
                    <div class="text-danger" id="discountPercentageError" style="font-size: small;">
                        {{#if message}}
                        <p>{{message}}</p>
                        {{/if}}
                    </div>
                </div>
                <div class="col-md-6 my-3">
                    <label for="minimumSpend" class="form-label">Minimun amount spend</label>
                    <input type="text" name="minimumSpend" class="form-control" id="minimumSpend" placeholder="eg: 500" onkeyup="validateMinAmount()" required>
                    <div class="text-danger" id="minAmountError" style="font-size: small;">
                        {{#if message}}
                        <p>{{message}}</p>
                        {{/if}}
                    </div>
                </div>
                <div class="col-md-6 my-3">
                    <label for="expiryAt" class="form-label">Coupon expiry date</label>
                    <input type="date" name="expiryAt" class="form-control" id="expiryAt" onchange="validateDate()" required>
                    <div class="text-danger" id="expiryDateError" style="font-size: small;">
                        {{#if message}}
                        <p>{{message}}</p>
                        {{/if}}
                    </div>
                </div>
                <div class="col-12 mb-3 mt-5">
                    <button type="submit" class="btn btn-primary">Add Coupon</button>
                </div>
            </form>
            <div class="text-danger" id="formError" style="font-size: small;">
                {{#if message}}
                    <p>{{message}}</p>
                {{/if}}
            </div>
        </div>
    </div>
</div>

<script>
    function validateCouponCode(){
        const alertBox = document.getElementById("couponCodeError");
        const coupon = document.getElementById('couponCode').value.trim();
        const couponRegex = /^[A-Z0-9]+$/;
        if(!couponRegex.test(coupon) || (coupon.length < 4) || (coupon.length > 8)){
            alertBox.innerText = "Coupon code must contain only uppercase letters and numbers with length between 4 and 8";
            return false;
        }
        alertBox.innerHTML = '';
        return true;
    }
    function validateDiscount(){
        const alertBox = document.getElementById("discountPercentageError");
        const discount = document.getElementById("discount").value.trim();
        const discountRegex = /^[0-9]+$/;
        if(discount < 5 || discount > 90){
            alertBox.innerHTML = "Discount must be between 5% and 90%";
            return false;
        }else if(!discountRegex.test(discount)){
            alertBox.innerHTML = "Discount must be a number";
            return false;
        }
        alertBox.innerHTML = "";
        return true;
    }
    function validateMinAmount(){
        const alertBox = document.getElementById("minAmountError");
        const minAmount = document.getElementById("minimumSpend").value.trim();
        const minAmountRegex = /^-?[0-9]+$/;
        if(!minAmountRegex.test(minAmount)){
            alertBox.innerHTML = "Minimum spend amount must be a number";
            return false;
        }else if(minAmount < 0){
            alertBox.innerHTML = "Minimun spend amount should not be negative";
            return false;
        }
        alertBox.innerHTML = "";
        return true;
    }
    function validateDate(){
        const alertBox = document.getElementById("expiryDateError");
        const expiryDate = document.getElementById("expiryAt").value;
        console.log(expiryDate);
        const currentDate = new Date();
        const enteredDate = new Date(expiryDate);
        if(enteredDate<currentDate){
            alertBox.innerHTML = "Select an upcoming date";
            document.getElementById("expiryAt").value = null;
            return false;
        }
        alertBox.innerHTML = "";
        return true;
    }
    const alertBox = document.getElementById("formError");
    const couponForm = document.getElementById("couponCodeForm");
    couponForm.addEventListener("submit",function(event){
        if(!validateCouponCode(document.getElementById("couponCode").value) ||
           !validateDiscount(document.getElementById("discount").value) ||
           !validateMinAmount(document.getElementById("minimumSpend").value) ||
           !validateDate(document.getElementById("expiryAt").value)){
             event.preventDefault();
             alertBox.innerHTML = "Enter correct values for each fields";
             return false;
        }else{
            alertBox.innerHTML = "";
            return true;
        }
    })
</script>
