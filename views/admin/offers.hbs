<div class="container-fluid d-flex" style="background-color: #D9D9D9;">
    <div class="sideMenu">
        <a href="/admin"><button type="button" class="btn btn-light sideMenuButton" ><i class="bi bi-view-list"></i> <span class="menuLabel"> Dashboard</span></button></a>
        <a href="/admin/customers"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-people-fill"></i><span class="menuLabel"> Customers</span></button></a>
        <a href="/admin/products"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-seam-fill"></i><span class="menuLabel"> Products</span></button></a>
        <a href="/admin/orders"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-receipt"></i><span class="menuLabel"> Orders</span></button></a>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-card-image"></i><span class="menuLabel"> Banner Management</span></button></a>
        <a href="/admin/coupons"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-ticket-perforated-fill"></i><span class="menuLabel"> Coupen Management</span></button></a>
        <a href="/admin/salesReport"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-journal-bookmark"></i><span class="menuLabel"> Sales Report</span></button></a>
        <a href="/admin/category"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-collection-fill"></i><span class="menuLabel"> Catagory</span></button></a>
        <a href="/admin/offers"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-graph-down-arrow"></i><span class="menuLabel"> Offers</span></button></a>
        <dir class="separator mt-3 pt-5"></dir>
        <a href=""><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-gear"></i><span class="menuLabel"> Settings</span></button></a>
        <a href="/admin/logout"><button type="button" class="btn btn-light sideMenuButton"><i class="bi bi-box-arrow-right"></i><span class="menuLabel"> Logout</span></button></a>
    </div>

    <section class="content-main ms-2" style="width: 80%;">
            <div class="content-header d-flex justify-content-between">
                <div>
                    <h2 class="content-title card-title my-5">Create Offers</h2>
                </div>
                <div>
                    <a href="/admin/addOffer" class="btn btn-primary btn-small my-5 me-5">Add offer</a>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-body">
                    <div class="table-responsive">
                        <div class="table-responsive">
                            <table class="table align-middle table-nowrap mb-0" id="salesReportTable">
                                <thead class="table-light" id="salesReportTableHead">
                                    <tr>
                                        <th class="align-middle" scope="col">Category</th>
                                        <th class="align-middle" scope="col">Offer in %</th>
                                        <th class="align-middle" scope="col">End date</th>
                                        <th class="align-middle" scope="col">Offer Status</th>
                                        <th class="align-middle" scope="col">Update</th>
                                    </tr>
                                </thead>
                                <tbody id="salesReportTableBody">
                                    {{#if formattedDateOffers}}
                                    {{#each formattedDateOffers}}
                                    <tr>
                                        <td>{{this.categoryName.catagoryName}}</td>
                                        <td>{{this.offerPercentage}}</td>
                                        <td>{{this.offerExpiryDate}}</td>
                                        {{#if this.isActive}}
                                        <td><span id="offerStatus_{{this._id}}" class="badge rounded-pill text-bg-success">Active</span></td>
                                        {{else}}
                                        <td><span id="offerStatus_{{this._id}}" class="badge rounded-pill text-bg-danger">Inactive</span></td>
                                        {{/if}}
                                        {{#if this.isActive}}
                                            <td>
                                            <a id="blockButton_{{this._id}}" class="btn btn-success mb-2" onclick="if (confirm(`Are you sure you want to update offer status`)) { statusUpdate('{{this._id}}'); }"><i class="bi bi-ban"></i></a>
                                            <a href="/admin/editOffer/{{this._id}}" class="btn btn-warning mb-2"><i class="bi bi-pencil-square"></i></a>
                                            <a href="/admin/deleteOffer/{{this._id}}" class="btn btn-danger mb-2" onclick="return confirm(`Are you sure want to delete this offer?`)"><i class="bi bi-trash-fill"></i></a>
                                            </td>
                                        {{else}}
                                            <td>
                                            <a id="blockButton_{{this._id}}" class="btn btn-danger" onclick="if (confirm(`Are you sure you want to update offer status`)) { statusUpdate('{{this._id}}'); }"><i class="bi bi-ban"></i></a>
                                            <a href="/admin/editOffer/{{this._id}}" class="btn btn-warning"><i class="bi bi-pencil-square"></i></a>
                                            <a href="/admin/deleteOffer/{{this._id}}" class="btn btn-danger" onclick="return confirm(`Are you sure want to delete this offer?`)"><i class="bi bi-trash-fill"></i></a>
                                            </td>
                                        {{/if}}

                                    </tr>
                                    {{/each}}
                                    {{else}}
                                        <td class="text-center fs-4" colspan="5"><span>No offers added</span></td>
                                    {{/if}}
                                </tbody>
                            </table>
                        </div>
                    </div> <!-- table-responsive end// -->
                </div>
            </div>
            {{!-- <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-start">
                        <li class="page-item active"><a class="page-link" href="#">01</a></li>
                        <li class="page-item"><a class="page-link" href="#">02</a></li>
                        <li class="page-item"><a class="page-link" href="#">03</a></li>
                        <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">16</a></li>
                        <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a></li>
                    </ul>
                </nav>
            </div> --}}
        </section> <!-- content-main end// -->
</div>    

<script>
    async function statusUpdate(id){
        console.log("id:",id);
        const ID = {offerId:id}
        try{
            const response = await fetch('/admin/updateStatus',{
                method:'POST',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify(ID)
            })
            const data = await response.json();
            console.log("data:",data);
            const blockButton = document.getElementById(`blockButton_${id}`);
            console.log("blockButton",blockButton);
            const offerStatus = document.getElementById(`offerStatus_${id}`);
            console.log("offerStatus",offerStatus);
            if(data.isActive){
                offerStatus.innerText = "Active";
                offerStatus.classList.remove("text-bg-danger");
                offerStatus.classList.add("text-bg-success");
                blockButton.classList.remove("btn-danger");
                blockButton.classList.add("btn-success");
            }else{
                offerStatus.innerText = "Inactive";
                offerStatus.classList.remove("text-bg-success");
                offerStatus.classList.add("text-bg-danger");
                blockButton.classList.remove("btn-success");
                blockButton.classList.add("btn-danger");
            }

        }catch(err){
            console.log("Error:",err.message);
        }
    }
</script>